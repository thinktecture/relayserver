<ion-header>
  <ion-toolbar>
    <ion-title>Tenants</ion-title>
    <ion-buttons slot="end">
      <ion-button id="add-tenant" aria-label="Add tenant">
        <ion-icon slot="icon-only" name="add" aria-hidden />
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  <ion-toolbar>
    <ion-searchbar (ionInput)="search($event)" [debounce]="500" />
  </ion-toolbar>
</ion-header>

<ion-content>
  @if (tenantsPage$ | async; as tenantsPage) {
    <ion-list>
      @for (tenant of tenantsPage.results; track tenant.name) {
        <ion-item
          [routerLink]="['/tabs', 'tenants', tenant.name]"
          [button]="true"
        >
          <ion-label>{{ tenant.displayName ?? tenant.name }}</ion-label>
          <ion-button
            slot="end"
            fill="clear"
            color="danger"
            (click)="deleteTenant($event, tenant)"
            aria-label="Delete tenant"
          >
            <ion-icon slot="icon-only" name="trash-outline" aria-hidden />
          </ion-button>
        </ion-item>
      }

      @if (tenantsPage.results.length >= tenantsPage.totalCount) {
        <ion-item>
          <ion-note>
            @if (filter() === "") {
              <span>{{ tenantsPage.results.length }} tenants in total</span>
            } @else {
              <span
                >{{ tenantsPage.results.length }} tenants matching
                {{ filter() }}</span
              >
            }
          </ion-note>
        </ion-item>
      }
    </ion-list>

    <ion-infinite-scroll
      (ionInfinite)="onInfinite($event)"
      [disabled]="tenantsPage.results.length >= tenantsPage.totalCount"
    >
      <ion-infinite-scroll-content></ion-infinite-scroll-content>
    </ion-infinite-scroll>
  }

  <ion-modal
    #modal
    trigger="add-tenant"
    [presentingElement]="presentingElement"
    (didPresent)="newTenant?.focus()"
  >
    <ng-template>
      <app-new-tenant (dismiss)="modal.dismiss()" #newTenant />
    </ng-template>
  </ion-modal>
</ion-content>
